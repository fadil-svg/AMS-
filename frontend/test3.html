<!DOCTYPE html>
<html class="fontawesome-i2svg-active fontawesome-i2svg-complete">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <script src="https://cdn.tailwindcss.com"></script>
    <script> window.FontAwesomeConfig = { autoReplaceSvg: 'nest'};</script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/js/all.min.js" crossorigin="anonymous" referrerpolicy="no-referrer"></script>
    <script src="https://unpkg.com/html5-qrcode" type="text/javascript"></script>
    
    <style>::-webkit-scrollbar { display: none;}</style>
    <script>tailwind.config = {
  "theme": {
    "extend": {
      "colors": {
        "primary": "#3B82F6",
        "success": "#10B981",
        "error": "#EF4444",
        "warning": "#F59E0B",
        "dark": "#0F172A"
      },
      "fontFamily": {
        "sans": [
          "Inter",
          "sans-serif"
        ]
      },
      "animation": {
        "pulse-border": "pulse-border 2s cubic-bezier(0.4, 0, 0.6, 1) infinite",
        "scan-line": "scan-line 2s linear infinite",
        "fade-in": "fade-in 0.5s ease-in-out",
        "slide-up": "slide-up 0.3s ease-out"
      },
      "keyframes": {
        "pulse-border": {
          "0%, 100%": {
            "borderColor": "rgba(59, 130, 246, 0.5)"
          },
          "50%": {
            "borderColor": "rgba(59, 130, 246, 1)"
          }
        },
        "scan-line": {
          "0%": {
            "transform": "translateY(0%)"
          },
          "50%": {
            "transform": "translateY(100%)"
          },
          "50.1%": {
            "transform": "translateY(0%)"
          },
          "100%": {
            "transform": "translateY(100%)"
          }
        },
        "fade-in": {
          "0%": {
            "opacity": "0"
          },
          "100%": {
            "opacity": "1"
          }
        },
        "slide-up": {
          "0%": {
            "transform": "translateY(10px)",
            "opacity": "0"
          },
          "100%": {
            "transform": "translateY(0)",
            "opacity": "1"
          }
        }
      },
      "backdropFilter": {
        "none": "none",
        "blur": "blur(20px)"
      }
    }
  }
};</script>
    <style>
        .scanner-container::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 2px;
            background: linear-gradient(to right, transparent, #3B82F6, transparent);
            animation: scan-line 2s linear infinite;
            box-shadow: 0 0 8px rgba(59, 130, 246, 0.8);
        }
        
        @keyframes scan-line {
            0% { top: 0; }
            50% { top: 100%; }
            50.1% { top: 0; }
            100% { top: 100%; }
        }
        
        .toast-enter {
            animation: toast-enter 0.5s ease forwards;
        }
        
        @keyframes toast-enter {
            0% { transform: translateY(-20px); opacity: 0; }
            100% { transform: translateY(0); opacity: 1; }
        }

        .error-message {
            background-color: rgba(239, 68, 68, 0.1);
            border: 1px solid rgba(239, 68, 68, 0.3);
            color: #EF4444;
            padding: 12px;
            border-radius: 8px;
            margin-bottom: 16px;
            display: none;
        }

        .permission-prompt {
            background-color: rgba(59, 130, 246, 0.1);
            border: 1px solid rgba(59, 130, 246, 0.3);
            color: #3B82F6;
            padding: 16px;
            border-radius: 8px;
            margin-bottom: 16px;
            text-align: center;
            display: none;
        }
    </style>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Inter:wght@100;200;300;500;600;700;800;900&display=swap">
    <style>
      body {
        font-family: 'Inter', sans-serif !important;
      }
      
      /* Preserve Font Awesome icons */
      .fa, .fas, .far, .fal, .fab {
        font-family: "Font Awesome 6 Free", "Font Awesome 6 Brands" !important;
      }
    </style>
</head>
<body class="bg-dark font-sans text-white min-h-screen">
    <!-- Header -->
    <header id="header" class="fixed top-0 left-0 right-0 bg-dark/80 backdrop-blur-md z-50 border-b border-gray-800">
        <div class="container mx-auto px-4 py-4 flex items-center justify-between">
            <div class="flex items-center space-x-3">
                <button id="back-button" class="p-2 rounded-full hover:bg-gray-800 transition">
                    <i class="fas fa-arrow-left text-gray-300"></i>
                </button>
                <div class="flex items-center">
                    <div class="h-8 w-8 bg-primary rounded-md flex items-center justify-center">
                        <i class="fas fa-qrcode text-white"></i>
                    </div>
                    <h1 class="ml-2 text-lg font-semibold">Scan to Sign In/Out</h1>
                </div>
            </div>
            <div>
                <button id="toggle-camera" class="p-2 rounded-full hover:bg-gray-800 transition" disabled>
                    <i class="fas fa-camera-rotate text-gray-300"></i>
                </button>
            </div>
        </div>
    </header>

    <!-- Main Content -->
    <main id="main-content" class="pt-20 pb-16 px-4 flex flex-col items-center justify-start min-h-screen">
        <!-- Permission Prompt -->
        <div id="permission-prompt" class="permission-prompt w-full max-w-md">
            <div class="flex flex-col items-center">
                <i class="fas fa-camera text-2xl mb-2"></i>
                <p class="font-medium mb-2">Camera Access Required</p>
                <p class="text-sm mb-4">Please allow camera access to scan QR codes</p>
                <button id="request-permission" class="bg-primary text-white px-4 py-2 rounded-lg hover:bg-primary/90 transition">
                    Enable Camera
                </button>
            </div>
        </div>

        <!-- Error Message -->
        <div id="error-message" class="error-message w-full max-w-md">
            <div class="flex items-center justify-between">
                <div class="flex items-center">
                    <i class="fas fa-exclamation-triangle mr-2"></i>
                    <span id="error-text">Camera access denied.</span>
                </div>
                <button id="retry-camera" class="text-sm underline hover:no-underline">Retry</button>
            </div>
            <div class="mt-2 text-sm">
                <p>To fix this:</p>
                <ul class="list-disc list-inside mt-1 text-xs">
                    <li>Allow camera permissions in browser settings</li>
                    <li>Refresh the page and try again</li>
                    <li>Use manual entry as alternative</li>
                </ul>
            </div>
        </div>

        <!-- Instructions -->
        <div id="instructions" class="text-center mb-6 animate-slide-up">
            <p class="text-gray-300 text-lg">Hold your QR code within the frame</p>
            <p class="text-gray-400 text-sm mt-1">Make sure it's well-lit and clearly visible</p>
        </div>
        
        <!-- Scanner Area -->
        <div id="scanner-area" class="relative w-full max-w-md aspect-square mb-8">
            <div class="absolute inset-0 bg-black/20 backdrop-blur-sm rounded-xl overflow-hidden">
                <div id="reader" class="w-full h-full"></div>
            </div>
            
            <!-- Scanner Frame -->
            <div class="scanner-container absolute inset-0 border-2 border-primary rounded-xl animate-pulse-border overflow-hidden">
                <div class="absolute top-0 left-0 w-16 h-16 border-t-2 border-l-2 border-primary"></div>
                <div class="absolute top-0 right-0 w-16 h-16 border-t-2 border-r-2 border-primary"></div>
                <div class="absolute bottom-0 left-0 w-16 h-16 border-b-2 border-l-2 border-primary"></div>
                <div class="absolute bottom-0 right-0 w-16 h-16 border-b-2 border-r-2 border-primary"></div>
            </div>
        </div>

        <!-- Status Toast (Initially Hidden) -->
        <div id="status-toast" class="fixed top-20 left-0 right-0 mx-auto max-w-md bg-white/10 backdrop-blur-md border border-white/20 p-4 rounded-lg shadow-lg hidden transform transition-all duration-300 ease-in-out">
            <div id="status-success" class="flex items-center space-x-3 hidden">
                <div class="flex-shrink-0 w-10 h-10 rounded-full bg-success/20 flex items-center justify-center">
                    <i class="fas fa-check text-success"></i>
                </div>
                <div class="flex-1">
                    <h3 class="font-medium">Welcome, <span id="user-name">John Doe</span></h3>
                    <p class="text-sm text-gray-300">You have signed in at <span id="sign-time">8:15 AM</span></p>
                </div>
            </div>
            
            <div id="status-signout" class="flex items-center space-x-3 hidden">
                <div class="flex-shrink-0 w-10 h-10 rounded-full bg-primary/20 flex items-center justify-center">
                    <i class="fas fa-right-from-bracket text-primary"></i>
                </div>
                <div class="flex-1">
                    <h3 class="font-medium">Goodbye, <span id="signout-name">John Doe</span></h3>
                    <p class="text-sm text-gray-300">Signed out successfully</p>
                </div>
            </div>
            
            <div id="status-error" class="flex items-center space-x-3 hidden">
                <div class="flex-shrink-0 w-10 h-10 rounded-full bg-error/20 flex items-center justify-center">
                    <i class="fas fa-xmark text-error"></i>
                </div>
                <div class="flex-1">
                    <h3 class="font-medium">QR Code not recognized</h3>
                    <p class="text-sm text-gray-300">Please try again or use manual entry</p>
                </div>
            </div>
            
            <div id="status-duplicate" class="flex items-center space-x-3 hidden">
                <div class="flex-shrink-0 w-10 h-10 rounded-full bg-warning/20 flex items-center justify-center">
                    <i class="fas fa-exclamation text-warning"></i>
                </div>
                <div class="flex-1">
                    <h3 class="font-medium">Already scanned today</h3>
                    <p class="text-sm text-gray-300">You've already signed in at <span id="previous-time">7:30 AM</span></p>
                </div>
            </div>
        </div>

        <!-- Manual Entry Button -->
         <input type="file" id="qr-image-input" accept="image/*" class="mt-4 p-2 border rounded" />

        <div id="manual-entry" class="mt-4 text-center">
            <button id="manual-entry-btn" class="text-primary hover:text-primary/80 transition flex items-center mx-auto">
                <span>Can't scan? Enter ID manually</span>
                <i class="fas fa-chevron-right ml-1 text-xs"></i>
            </button>
        </div>
    </main>

    <!-- Manual Entry Modal (Initially Hidden) -->
    <div id="manual-entry-modal" class="fixed inset-0 bg-black/70 backdrop-blur-sm flex items-center justify-center z-50 hidden">
        <div class="bg-gray-900 border border-gray-800 rounded-xl w-full max-w-md mx-4 p-6 shadow-2xl">
            <div class="flex justify-between items-center mb-6">
                <h2 class="text-xl font-semibold">Manual Sign In/Out</h2>
                <button id="close-modal" class="text-gray-400 hover:text-white">
                    <i class="fas fa-xmark"></i>
                </button>
            </div>
            
            <form id="manual-form">
                <div class="mb-4">
                    <label for="student-id" class="block text-sm font-medium text-gray-300 mb-1">Student ID</label>
                    <input type="text" id="student-id" class="w-full bg-gray-800 border border-gray-700 rounded-lg px-4 py-3 text-white focus:outline-none focus:ring-2 focus:ring-primary" placeholder="Enter your student ID" required minlength="3" maxlength="20">
                    <div id="input-error" class="text-error text-sm mt-1 hidden">Please enter a valid student ID (3-20 characters)</div>
                </div>
                
                <div class="mb-6">
                    <label class="block text-sm font-medium text-gray-300 mb-1">Action</label>
                    <div class="grid grid-cols-2 gap-4">
                        <button type="button" id="sign-in-btn" class="bg-primary/20 border border-primary/40 text-primary rounded-lg py-3 hover:bg-primary/30 transition focus:outline-none focus:ring-2 focus:ring-primary" data-action="signin">
                            <i class="fas fa-right-to-bracket mr-2"></i>Sign In
                        </button>
                        <button type="button" id="sign-out-btn" class="bg-gray-800 border border-gray-700 text-gray-300 rounded-lg py-3 hover:bg-gray-700 transition focus:outline-none focus:ring-2 focus:ring-gray-600" data-action="signout">
                            <i class="fas fa-right-from-bracket mr-2"></i>Sign Out
                        </button>
                    </div>
                </div>
                
                <button type="submit" class="w-full bg-primary hover:bg-primary/90 text-white font-medium py-3 rounded-lg transition focus:outline-none focus:ring-2 focus:ring-primary">
                    Submit
                </button>
            </form>
        </div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            let html5QrcodeScanner = null;
            let isScanning = false;
            let scanInProgress = false;
            let selectedAction = 'signin';
            let permissionGranted = false;
            
            // Initialize the app
            initializeApp();
            
            async function initializeApp() {
                // Check if we're on HTTPS or localhost (required for camera access)
                if (location.protocol !== 'https:' && location.hostname !== 'localhost' && location.hostname !== '127.0.0.1') {
                    showError('Camera access requires HTTPS. Please use a secure connection.');
                    return;
                }

                // Show permission prompt initially
                showPermissionPrompt();
                
                // Set up event listeners
                setupEventListeners();
            }
            
            function setupEventListeners() {
                document.getElementById('request-permission').addEventListener('click', requestCameraPermission);
                document.getElementById('retry-camera').addEventListener('click', requestCameraPermission);
                document.getElementById('toggle-camera').addEventListener('click', switchCamera);
            }
            
            async function requestCameraPermission() {
                hidePermissionPrompt();
                hideError();
                
                try {
                    // First check if getUserMedia is supported
                    if (!navigator.mediaDevices || !navigator.mediaDevices.getUserMedia) {
                        throw new Error('Camera API not supported on this device/browser');
                    }
                    
                    // Request camera permission explicitly first
                    const stream = await navigator.mediaDevices.getUserMedia({ 
                        video: { 
                            facingMode: 'environment',
                            width: { ideal: 1280 },
                            height: { ideal: 720 }
                        } 
                    });
                    
                    // Stop the stream immediately - we just wanted permission
                    stream.getTracks().forEach(track => track.stop());
                    
                    permissionGranted = true;
                    await initializeScanner();
                    
                } catch (error) {
                    handleCameraError(error);
                }
            }
            
            async function initializeScanner() {
                try {
                    // Get available cameras
                    const cameras = await Html5Qrcode.getCameras();
                    
                    if (cameras.length === 0) {
                        throw new Error('No cameras found on this device');
                    }
                    
                    console.log('Available cameras:', cameras);
                    
                    // Enable camera toggle if multiple cameras available
                    const toggleBtn = document.getElementById('toggle-camera');
                    if (cameras.length > 1) {
                        toggleBtn.disabled = false;
                    }
                    
                    await startScanner();
                    
                } catch (error) {
                    handleCameraError(error);
                }
            }
            
            async function startScanner() {
                if (html5QrcodeScanner) {
                    await stopScanner();
                }
                
                try {
                    html5QrcodeScanner = new Html5Qrcode("reader");
                    
                    // Use facingMode constraint for better mobile support
                    const config = {
                        fps: 10,
                        qrbox: { width: 250, height: 250 },
                        aspectRatio: 1.0
                    };
                    
                    // Try environment (back) camera first, then user (front) camera
                    const cameraConfig = { facingMode: "environment" };
                    
                    await html5QrcodeScanner.start(
                        cameraConfig,
                        config,
                        onScanSuccess,
                        onScanFailure
                    );
                    
                    isScanning = true;
                    hideError();
                    hidePermissionPrompt();
                    
                    console.log('Scanner started successfully');
                    
                } catch (error) {
                    console.error('Failed to start scanner:', error);
                    
                    // Try with user camera as fallback
                    try {
                        const fallbackConfig = { facingMode: "user" };
                        await html5QrcodeScanner.start(
                            fallbackConfig,
                            config,
                            onScanSuccess,
                            onScanFailure
                        );
                        
                        isScanning = true;
                        hideError();
                        hidePermissionPrompt();
                        
                        console.log('Scanner started with front camera');
                        
                    } catch (fallbackError) {
                        throw new Error('Failed to start camera: ' + fallbackError.message);
                    }
                }
            }
            
            async function stopScanner() {
                if (html5QrcodeScanner && isScanning) {
                    try {
                        await html5QrcodeScanner.stop();
                        html5QrcodeScanner.clear();
                        html5QrcodeScanner = null;
                        isScanning = false;
                        console.log('Scanner stopped');
                    } catch (error) {
                        console.warn('Error stopping scanner:', error);
                        // Force cleanup
                        html5QrcodeScanner = null;
                        isScanning = false;
                    }
                }
            }
            
            async function switchCamera() {
                if (!isScanning) return;
                
                try {
                    await stopScanner();
                    
                    // Toggle between environment and user cameras
                    const currentCamera = document.querySelector('#reader video') ? 'environment' : 'user';
                    const newCamera = currentCamera === 'environment' ? 'user' : 'environment';
                    
                    html5QrcodeScanner = new Html5Qrcode("reader");
                    const config = {
                        fps: 10,
                        qrbox: { width: 250, height: 250 },
                        aspectRatio: 1.0
                    };
                    
                    await html5QrcodeScanner.start(
                        { facingMode: newCamera },
                        config,
                        onScanSuccess,
                        onScanFailure
                    );
                    
                    isScanning = true;
                    
                } catch (error) {
                    console.error('Error switching camera:', error);
                    // Try to restart with original camera
                    await startScanner();
                }
            }
            
            function onScanSuccess(decodedText, decodedResult) {
                // Prevent multiple rapid scans
                if (scanInProgress) return;
                scanInProgress = true;
                
                // Vibrate if supported
                if (navigator.vibrate) {
                    navigator.vibrate(200);
                }
                
                // Pause scanner temporarily
                if (html5QrcodeScanner && isScanning) {
                    html5QrcodeScanner.pause();
                }
                
                console.log(`QR Code detected: ${decodedText}`);
                
                // Validate QR code format (basic validation)
                if (!isValidQRCode(decodedText)) {
                    showToast('error');
                    resumeScanning();
                    return;
                }
                
                // Process the scan result
                processQRCode(decodedText);
            }
            document.getElementById('qr-image-input').addEventListener('change', function (e) {
            const file = e.target.files[0];

            if (!file) {
                alert("Please select a file");
                return;
            }

            html5QrCode.scanFile(file, true)
            .then(decodedText => {
                console.log("Scanned from image: ", decodedText);
            // You can use your existing processQRCode(decodedText) here
                processQRCode(decodedText);
            })
            .catch(err => {
                console.error("Image scan error: ", err);
                alert("Could not read QR code from image.");
                });
            });

            
            function onScanFailure(error) {
                // Silently handle scan failures - they're normal during scanning
                // Only log if it's an actual error, not just "no code found"
                if (!error.includes('No MultiFormat Readers were able to detect the code')) {
                    console.warn('Scan failure:', error);
                }
            }
            
            function isValidQRCode(code) {
                // Basic validation - adjust according to your QR code format
                return code && code.length >= 3 && code.length <= 50;
            }
            
            function processQRCode(code) {
                // Simulate API call with different scenarios
                const scenarios = ['success', 'signout', 'duplicate', 'error'];
                const randomScenario = scenarios[Math.floor(Math.random() * scenarios.length)];
                
                // Show appropriate toast
                showToast(randomScenario, code);
                
                // Resume scanning after delay
                setTimeout(() => {
                    resumeScanning();
                }, 3000);
            }
            
            function resumeScanning() {
                scanInProgress = false;
                if (html5QrcodeScanner && isScanning) {
                    try {
                        html5QrcodeScanner.resume();
                    } catch (error) {
                        console.warn('Error resuming scanner:', error);
                        // Try to restart scanner if resume fails
                        startScanner();
                    }
                }
            }
            
            function handleCameraError(error) {
                console.error('Camera error:', error);
                
                let message = 'Camera access failed. ';
                if (error.name === 'NotAllowedError' || error.name === 'PermissionDeniedError') {
                    message = 'Camera permission denied. ';
                } else if (error.name === 'NotFoundError' || error.name === 'DevicesNotFoundError') {
                    message = 'No camera found on this device. ';
                } else if (error.name === 'NotSupportedError') {
                    message = 'Camera not supported on this browser. ';
                } else if (error.name === 'NotReadableError') {
                    message = 'Camera is already in use by another application. ';
                } else if (error.message) {
                    message = error.message;
                }
                
                showError(message);
                showPermissionPrompt();
                
                // Disable camera toggle on error
                const toggleBtn = document.getElementById('toggle-camera');
                toggleBtn.disabled = true;
            }
            
            function showPermissionPrompt() {
                document.getElementById('permission-prompt').style.display = 'block';
            }
            
            function hidePermissionPrompt() {
                document.getElementById('permission-prompt').style.display = 'none';
            }
            
            function showError(message) {
                const errorDiv = document.getElementById('error-message');
                const errorText = document.getElementById('error-text');
                errorText.textContent = message;
                errorDiv.style.display = 'block';
            }
            
            function hideError() {
                const errorDiv = document.getElementById('error-message');
                errorDiv.style.display = 'none';
            }
            
            // Toast management
            function showToast(type, qrData = null) {
                const toast = document.getElementById('status-toast');
                const success = document.getElementById('status-success');
                const signout = document.getElementById('status-signout');
                const error = document.getElementById('status-error');
                const duplicate = document.getElementById('status-duplicate');
                
                // Hide all states first
                [success, signout, error, duplicate].forEach(el => el.classList.add('hidden'));
                
                // Set current time
                const now = new Date();
                const timeString = now.toLocaleTimeString([], { hour: 'numeric', minute: '2-digit' });
                
                // Show appropriate state
                switch(type) {
                    case 'success':
                        document.getElementById('user-name').textContent = getNameFromQR(qrData) || 'Jane Smith';
                        document.getElementById('sign-time').textContent = timeString;
                        success.classList.remove('hidden');
                        break;
                    case 'signout':
                        document.getElementById('signout-name').textContent = getNameFromQR(qrData) || 'Jane Smith';
                        signout.classList.remove('hidden');
                        break;
                    case 'error':
                        error.classList.remove('hidden');
                        break;
                    case 'duplicate':
                        document.getElementById('previous-time').textContent = '7:30 AM';
                        duplicate.classList.remove('hidden');
                        break;
                }
                
                // Show toast with animation
                toast.classList.remove('hidden');
                requestAnimationFrame(() => {
                    toast.classList.add('toast-enter');
                });
                
                // Hide toast after delay
                setTimeout(() => {
                    toast.classList.add('hidden');
                    toast.classList.remove('toast-enter');
                }, 3000);
            }
            
            function getNameFromQR(qrData) {
                // Extract name from QR code data if available
                return qrData ? `Student ${qrData.substring(0, 5)}` : null;
            }
            
            // Modal management
            const manualEntryBtn = document.getElementById('manual-entry-btn');
            const manualEntryModal = document.getElementById('manual-entry-modal');
            const closeModalBtn = document.getElementById('close-modal');
            
            manualEntryBtn.addEventListener('click', openModal);
            closeModalBtn.addEventListener('click', closeModal);
            
            // Close modal on outside click
            manualEntryModal.addEventListener('click', (e) => {
                if (e.target === manualEntryModal) {
                    closeModal();
                }
            });
            
            // Close modal on Escape key
            document.addEventListener('keydown', (e) => {
                if (e.key === 'Escape' && !manualEntryModal.classList.contains('hidden')) {
                    closeModal();
                }
            });
            
            function openModal() {
                manualEntryModal.classList.remove('hidden');
                document.getElementById('student-id').focus();
            }
            
            function closeModal() {
                manualEntryModal.classList.add('hidden');
                document.getElementById('manual-form').reset();
                hideInputError();
                resetActionButtons();
            }
            
            // Action button toggle
            const signInBtn = document.getElementById('sign-in-btn');
            const signOutBtn = document.getElementById('sign-out-btn');
            
            signInBtn.addEventListener('click', () => selectAction('signin'));
            signOutBtn.addEventListener('click', () => selectAction('signout'));
            
            function selectAction(action) {
                selectedAction = action;
                
                if (action === 'signin') {
                    signInBtn.classList.remove('bg-gray-800', 'border-gray-700', 'text-gray-300');
                    signInBtn.classList.add('bg-primary/20', 'border-primary/40', 'text-primary');
                    
                    signOutBtn.classList.remove('bg-primary/20', 'border-primary/40', 'text-primary');
                    signOutBtn.classList.add('bg-gray-800', 'border-gray-700', 'text-gray-300');
                } else {
                    signOutBtn.classList.remove('bg-gray-800', 'border-gray-700', 'text-gray-300');
                    signOutBtn.classList.add('bg-primary/20', 'border-primary/40', 'text-primary');
                    
                    signInBtn.classList.remove('bg-primary/20', 'border-primary/40', 'text-primary');
                    signInBtn.classList.add('bg-gray-800', 'border-gray-700', 'text-gray-300');
                }
            }
            // Form submission
            const manualForm = document.getElementById('manual-form');
            manualForm.addEventListener('submit', async (e) => {                    
                e.preventDefault();
                
                const studentId = document.getElementById('student-id').value.trim();
                
                // Validate input
                if (!validateStudentId(studentId)) {
                    showInputError('Please enter a valid student ID (3-20 characters)');
                    return;
                }
                
                // Simulate API call
                try {
                    const response = await fakeApiCall(studentId, selectedAction);
                    
                    if (response.success) {
                        showToast(selectedAction === 'signin' ? 'success' : 'signout', studentId);
                        closeModal();
                    } else if (response.error === 'duplicate') {
                        showToast('duplicate', studentId);
                    } else {
                        showToast('error');
                    }
                    
                } catch (error) {
                    console.error('API error:', error);
                    showToast('error');
                }
            });
            function validateStudentId(id) {
                return id && id.length >= 3 && id.length <= 20;
            }
            function showInputError(message) {
                const inputError = document.getElementById('input-error');
                inputError.textContent = message;
                inputError.classList.remove('hidden');
            }
            function hideInputError() {
                const inputError = document.getElementById('input-error');
                inputError.classList.add('hidden');
            }
            function resetActionButtons() {
                signInBtn.classList.remove('bg-primary/20', 'border-primary/40', 'text-primary');
                signInBtn.classList.add('bg-gray-800', 'border-gray-700', 'text-gray-300');
                
                signOutBtn.classList.remove('bg-primary/20', 'border-primary/40', 'text-primary');
                signOutBtn.classList.add('bg-gray-800', 'border-gray-700', 'text-gray-300');
                
                selectedAction = 'signin';
            }
            async function fakeApiCall(studentId, action) {
                // Simulate network delay
                await new Promise(resolve => setTimeout(resolve, 1000));
                return { success: true };
            }
        });
    </script>
    <script src="https://unpkg.com/html5-qrcode/minified/html5-qrcode.min.js"></script>
    <script src="https://unpkg.com/html5-qrcode/minified/html5-qrcode.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html5-qrcode/2.0.0/html5-qrcode.min.js"></script>
    </body>
    </html>
